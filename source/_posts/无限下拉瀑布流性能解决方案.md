title: 无限下拉瀑布流性能解决方案
date: 2013-12-30 19:30:20
tags: [性能优化, JavaScript]
---

#无限下拉瀑布流性能解决方案

##简介
目前在各大小的的网站都能见到这种布局的页面，比如Baidu图片搜索、淘宝网、蘑菇街等等，采用这种布局已经成了各个网站对于显示以图片为主要展示内容的最优布局选择。这种布局方式被称为：瀑布流式布局。瀑布流式布局的采用淘宝乔花的解释是“适合小数据块，每个数据块内容相近且没有侧重，随着页面向下滚动，这种布局还会不断加载数据块并附加至当前尾部”。

     但是这种布局方式会存在一定的性能问题，随着页面向下滚动，页面里面的内容会逐渐增加，这样也就导致了浏览器的内存越来越多，直至最后内存消耗完，电脑卡死。比如Baidu图片搜索采用了无限下拉的方式，随着页面不断的向下滚动，浏览器所占的内存也在不断的增加，当滚动到一定高度后，可以很明显的感觉到页面滚动变得不流畅，甚至会出现因内存使用过多而导致浏览器卡死的现象。

     对于这种问题，多数的网站采用了分页的方式来限制页面中元素的数量来规避页面向下滚动而带来的问题（当然采用分页也可能是产品需求），那么是否有一种不用分页可以无限下拉但是不会引起页面性能下降的方法呢？答案是有的，这里大家可以访问一下贴吧的图片列表墙页面，请点击。在这个页面里，随着页面不断的向下滚动，可以观察到浏览器内存的占用变化比较小，而且页面也不会随着不断的滚动而导致浏览器反应变慢。这是如何做到的呢？下面就来为大家介绍一下瀑布流下拉不影响页面性能的解决方法。

 

解决思路和实现方法

1.  定位策略的选择：absolute

首先我们知道瀑布流布局的内容是不断变化的，每一次变化都可能会导致浏览器对整个页面重新布局或重绘，而这个过程是十分消耗性能的，但是采用absolute或fixed定位元素位置可以使改变的对象脱离渲染树，从而内容或位置的改变不会对整个页面造成影响，而采用normal的定位方式（static和relative）则会引起整个页面内容的重新绘制导致页面内容变化时性能下降。所以为了尽可能的减少瀑布流布局下拉对性能的影响，采用了以absolute定位每个Item的方式（比fixed定位更灵活）。

2.  核心思路及实现方法

我们知道，页面性能下降最主要的原因是随着页面向下滚动页面内容（Dom节点和图片）不断增加导致。那么我们解决性能问题，首先要考虑是否有办法做到在保持页面元素数量基本不变而又不影响给用户呈现内容：重用Dom元素，当页面滚动时将不在显示区域的Dom移动到可视区域内，并将里面的内容替换成需要显示的内容，因为我们采用了absolute定位的方式，所以Dom元素位置和内容的改变对整个页面性能的影响不大，同时页面中Dom元素的数量基本保持不变，从而保证页面滚动时性能不会受到太大的影响。那么具体是如何实现的呢？

1.  首先为瀑布流布局中每个区块定义为一个Item类，该类提供了区块Dom复用时需要的方法，代码：

http://wenzhang.baidu.com/page/view?key=ffb7e3818f34610b-1427245457